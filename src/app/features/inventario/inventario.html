<div class="min-h-screen bg-gray-50 p-4 sm:p-6 lg:p-8">
  <!-- Header -->
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">üì¶ Inventario</h1>
    <p class="text-gray-600">Gestiona tus productos, stock y categor√≠as</p>
  </div>

  <!-- Estad√≠sticas -->
  <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
    <!-- Total Productos -->
    <div
      class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md transition-shadow"
    >
      <div class="flex items-center gap-3">
        <div class="p-3 bg-blue-100 rounded-lg">
          <span class="text-2xl">üì¶</span>
        </div>
        <div>
          <p class="text-sm text-gray-600">Total</p>
          <p class="text-2xl font-bold text-gray-900">
            {{ estadisticas().total }}
          </p>
        </div>
      </div>
    </div>

    <!-- Stock Bajo -->
    <div
      class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md transition-shadow"
    >
      <div class="flex items-center gap-3">
        <div class="p-3 bg-yellow-100 rounded-lg">
          <span class="text-2xl">‚ö†Ô∏è</span>
        </div>
        <div>
          <p class="text-sm text-gray-600">Stock Bajo</p>
          <p class="text-2xl font-bold text-yellow-600">
            {{ estadisticas().stockBajo }}
          </p>
        </div>
      </div>
    </div>

    <!-- Sin Stock -->
    <div
      class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md transition-shadow"
    >
      <div class="flex items-center gap-3">
        <div class="p-3 bg-red-100 rounded-lg">
          <span class="text-2xl">‚ùå</span>
        </div>
        <div>
          <p class="text-sm text-gray-600">Sin Stock</p>
          <p class="text-2xl font-bold text-red-600">
            {{ estadisticas().sinStock }}
          </p>
        </div>
      </div>
    </div>

    <!-- Consignaci√≥n -->
    <div
      class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md transition-shadow"
    >
      <div class="flex items-center gap-3">
        <div class="p-3 bg-purple-100 rounded-lg">
          <span class="text-2xl">ü§ù</span>
        </div>
        <div>
          <p class="text-sm text-gray-600">Consignaci√≥n</p>
          <p class="text-2xl font-bold text-purple-600">
            {{ estadisticas().consignacion }}
          </p>
        </div>
      </div>
    </div>

    <!-- Valor Inventario -->
    <div
      class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md transition-shadow"
    >
      <div class="flex items-center gap-3">
        <div class="p-3 bg-green-100 rounded-lg">
          <span class="text-2xl">üí∞</span>
        </div>
        <div>
          <p class="text-sm text-gray-600">Valor</p>
          <p class="text-lg font-bold text-green-600">
            {{ formatearMoneda(estadisticas().valorInventario) }}
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Barra de Herramientas -->
  <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 mb-6">
    <div class="flex flex-col lg:flex-row gap-4">
      <!-- B√∫squeda -->
      <div class="flex-1">
        <div class="relative">
          <span
            class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xl"
          >
            üîç
          </span>
          <input
            type="text"
            [(ngModel)]="busqueda"
            placeholder="Buscar por nombre, descripci√≥n o c√≥digo de barras..."
            class="w-full pl-12 pr-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
          />
        </div>
      </div>

      <!-- Categor√≠a -->
      <div class="w-full lg:w-64">
        <select
          [(ngModel)]="categoriaSeleccionada"
          class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all appearance-none bg-white cursor-pointer"
        >
          @for (cat of categorias; track cat.valor) {
          <option [value]="cat.valor">
            {{ cat.emoji }} {{ cat.etiqueta }}
          </option>
          }
        </select>
      </div>

      <!-- Filtro de Proveedor -->
      <div class="w-full lg:w-64">
        <select
          [(ngModel)]="proveedorSeleccionado"
          class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all appearance-none bg-white cursor-pointer"
        >
          <option value="todos">üè¢ Todos los proveedores</option>
          @for (prov of proveedores(); track prov._id) {
          <option [value]="prov._id">
            {{ prov.nombre }} @if (prov.productosCargados > 0) { ({{
            prov.productosCargados }}) }
          </option>
          }
        </select>
      </div>

      <!-- Filtros R√°pidos -->
      <div class="flex flex-wrap gap-2">
        <button
          (click)="soloStockBajo.set(!soloStockBajo())"
          [class]="soloStockBajo() 
            ? 'bg-yellow-500 text-white' 
            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
          class="px-4 py-2 rounded-lg font-semibold transition-colors whitespace-nowrap"
        >
          ‚ö†Ô∏è Stock Bajo
        </button>

        <button
          (click)="soloConsignacion.set(!soloConsignacion())"
          [class]="soloConsignacion() 
            ? 'bg-purple-500 text-white' 
            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
          class="px-4 py-2 rounded-lg font-semibold transition-colors whitespace-nowrap"
        >
          ü§ù Consignaci√≥n
        </button>

        @if (busqueda() || categoriaSeleccionada() !== 'todas' ||
        soloStockBajo() || soloConsignacion()) {
        <button
          (click)="limpiarFiltros()"
          class="px-4 py-2 bg-red-100 text-red-700 hover:bg-red-200 rounded-lg font-semibold transition-colors whitespace-nowrap"
        >
          üîÑ Limpiar
        </button>
        }
      </div>
    </div>

    <!-- Controles Adicionales -->
    <div
      class="flex items-center justify-between mt-4 pt-4 border-t border-gray-200 flex-wrap gap-3"
    >
      <!-- Vista Grid/Lista -->
      <div class="flex gap-2">
        <button
          (click)="cambiarVista('grid')"
          [class]="vistaActual() === 'grid' 
            ? 'bg-blue-500 text-white' 
            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
          class="px-4 py-2 rounded-lg font-semibold transition-colors"
        >
          üî≤ Grid
        </button>

        <button
          (click)="cambiarVista('lista')"
          [class]="vistaActual() === 'lista' 
            ? 'bg-blue-500 text-white' 
            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
          class="px-4 py-2 rounded-lg font-semibold transition-colors"
        >
          üìã Lista
        </button>
      </div>

      <!-- Opciones de Visualizaci√≥n -->
      <div class="flex gap-2 flex-wrap">
        <button
          (click)="toggleMostrarProveedores()"
          [class]="mostrarProveedores() 
            ? 'bg-blue-500 text-white' 
            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
          class="px-4 py-2 rounded-lg font-semibold transition-colors whitespace-nowrap text-sm"
        >
          {{ mostrarProveedores() ? '‚úÖ' : '‚òê' }} Mostrar Proveedores
        </button>

        <button
          (click)="toggleMostrarCodigosBarras()"
          [class]="mostrarCodigosBarras() 
            ? 'bg-blue-500 text-white' 
            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
          class="px-4 py-2 rounded-lg font-semibold transition-colors whitespace-nowrap text-sm"
        >
          {{ mostrarCodigosBarras() ? '‚úÖ' : '‚òê' }} Mostrar C√≥digos
        </button>
      </div>

      <!-- Bot√≥n Nuevo Producto -->
      <button
        (click)="abrirModalNuevo()"
        class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg transition-colors flex items-center gap-2 shadow-md hover:shadow-lg"
      >
        <span class="text-xl">‚ûï</span>
        <span>Nuevo Producto</span>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  @if (cargando()) {
  <div class="flex items-center justify-center py-12">
    <div class="text-center">
      <div
        class="inline-block animate-spin rounded-full h-12 w-12 border-b-4 border-blue-600 mb-4"
      ></div>
      <p class="text-gray-600">Cargando productos...</p>
    </div>
  </div>
  }

  <!-- Error State -->
  @else if (error()) {
  <div class="bg-red-50 border-l-4 border-red-500 rounded-lg p-6 animate-shake">
    <div class="flex items-start gap-3">
      <span class="text-3xl">‚ö†Ô∏è</span>
      <div>
        <p class="font-semibold text-red-800 text-lg">
          Error al cargar inventario
        </p>
        <p class="text-red-700 mt-1">{{ error() }}</p>
        <button
          (click)="cargarProductos()"
          class="mt-3 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors"
        >
          üîÑ Reintentar
        </button>
      </div>
    </div>
  </div>
  }

  <!-- Lista de Productos -->
  @else { @if (productosFiltrados().length === 0) {
  <!-- Empty State -->
  <div
    class="bg-white rounded-xl p-12 text-center shadow-sm border border-gray-100"
  >
    <span class="text-6xl mb-4 block">üì¶</span>
    <h3 class="text-xl font-bold text-gray-800 mb-2">
      No se encontraron productos
    </h3>
    <p class="text-gray-600 mb-4">
      @if (busqueda() || categoriaSeleccionada() !== 'todas' || soloStockBajo()
      || soloConsignacion()) { Intenta ajustar los filtros de b√∫squeda } @else {
      Comienza agregando tu primer producto al inventario }
    </p>
    @if (busqueda() || categoriaSeleccionada() !== 'todas' || soloStockBajo() ||
    soloConsignacion()) {
    <button
      (click)="limpiarFiltros()"
      class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors"
    >
      Limpiar Filtros
    </button>
    } @else {
    <button
      (click)="abrirModalNuevo()"
      class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition-colors"
    >
      ‚ûï Agregar Primer Producto
    </button>
    }
  </div>
  } @else {
  <!-- Vista Grid -->
  @if (vistaActual() === 'grid') {
  <div
    class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4"
  >
    @for (producto of productosFiltrados(); track producto._id) {
    <div
      class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-lg transition-all duration-200 transform hover:-translate-y-1"
    >
      <!-- Imagen del Producto -->
      <!-- <div class="relative h-48 bg-linear-to-br from-gray-100 to-gray-200">
        @if (producto.imagen) {
        <img
          [src]="producto.imagen"
          [alt]="producto.nombre"
          class="w-full h-full object-cover"
          loading="lazy"
        />
        } @else {
        <div class="flex items-center justify-center h-full">
          <span class="text-6xl">
            {{ obtenerEmojiCategoria(producto.categoria) }}
          </span>
        </div>
        }

        <div class="absolute top-2 left-2 flex flex-col gap-2">
          @if (producto.esConsignacion) {
          <span
            class="px-2 py-1 bg-purple-500 text-white text-xs font-bold rounded-full shadow-md"
          >
            ü§ù Consignaci√≥n
          </span>
          }

          <span
            [class]="obtenerClaseEstadoStock(producto)"
            class="px-2 py-1 text-xs font-bold rounded-full shadow-md"
          >
            {{ obtenerTextoEstadoStock(producto) }}
          </span>
        </div>
      </div> -->

      <!-- Informaci√≥n -->
      <div class="p-4">
        <!-- C√≥digo de Barras (NUEVO) -->
        @if (mostrarCodigosBarras() && producto.codigoBarras) {
        <div class="mb-2 flex items-center gap-2">
          <span
            class="text-xs font-mono text-gray-500 bg-gray-100 px-2 py-1 rounded flex-1"
          >
            üìä {{ formatearCodigoBarras(producto.codigoBarras) }}
          </span>

          <!-- ‚úÖ NUEVO: Bot√≥n para ver/descargar c√≥digo -->
          <button
            (click)="abrirModalCodigoBarras(producto)"
            class="px-2 py-1 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded text-xs font-semibold transition-colors"
            title="Ver c√≥digo de barras"
          >
            üè∑Ô∏è
          </button>
        </div>
        }

        <h3
          class="text-lg font-bold text-gray-900 mb-1 truncate"
          [title]="producto.nombre"
        >
          {{ producto.nombre }}
        </h3>

        <!-- Proveedor (NUEVO) -->
        @if (mostrarProveedores() && producto.proveedor) {
        <div class="flex items-center gap-2 mb-2">
          <span
            class="text-xs text-purple-600 bg-purple-100 px-2 py-1 rounded-full font-semibold"
          >
            üè¢ {{ producto.proveedor.nombre }}
          </span>
        </div>
        }

        <p class="text-sm text-gray-600 mb-3 line-clamp-2 h-10">
          {{ producto.descripcion }}
        </p>

        <!-- Precio y Stock -->
        <div
          class="flex items-center justify-between mb-3 pb-3 border-b border-gray-100"
        >
          <div>
            <p class="text-xs text-gray-500">Precio Venta</p>
            <p class="text-xl font-bold text-green-600">
              {{ formatearMoneda(producto.precioVenta) }}
            </p>
            <p class="text-xs text-gray-500 mt-1">
              Margen: {{ calcularMargenGanancia(producto).toFixed(1) }}%
            </p>
          </div>

          <div class="text-right">
            <p class="text-xs text-gray-500">Stock</p>
            <p class="text-xl font-bold text-gray-900">{{ producto.stock }}</p>
            <p class="text-xs text-gray-500 mt-1">
              M√≠n: {{ producto.stockMinimo }}
            </p>
          </div>
        </div>

        <!-- Acciones -->
        <div class="flex gap-2">
          @if (producto.codigoBarras) {
          <!-- ‚úÖ NUEVO: Bot√≥n grande para c√≥digo de barras -->
          <button
            (click)="abrirModalCodigoBarras(producto)"
            class="px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm font-semibold rounded-lg transition-colors"
            title="Ver c√≥digo de barras"
          >
            üè∑Ô∏è
          </button>
          }

          <button
            (click)="abrirModalEditar(producto)"
            class="flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold rounded-lg transition-colors"
          >
            ‚úèÔ∏è Editar
          </button>

          <button
            (click)="eliminarProducto(producto)"
            class="px-3 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-semibold rounded-lg transition-colors"
          >
            üóëÔ∏è
          </button>
        </div>
      </div>
    </div>
    }
  </div>
  }

  <!-- Vista Lista -->
  @else {
  <div
    class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"
  >
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-gray-50 border-b border-gray-200">
          <tr>
            <th
              class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider"
            >
              Producto
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider"
            >
              Categor√≠a
            </th>
            <th
              class="px-6 py-3 text-right text-xs font-semibold text-gray-700 uppercase tracking-wider"
            >
              P. Compra
            </th>
            <th
              class="px-6 py-3 text-right text-xs font-semibold text-gray-700 uppercase tracking-wider"
            >
              P. Venta
            </th>
            <th
              class="px-6 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider"
            >
              Stock
            </th>
            <th
              class="px-6 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider"
            >
              Estado
            </th>
            <th
              class="px-6 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider"
            >
              Acciones
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200 bg-white">
          @for (producto of productosFiltrados(); track producto._id) {
          <tr class="hover:bg-gray-50 transition-colors">
            <!-- Producto -->
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center gap-3">
                <div
                  class="w-12 h-12 rounded-lg bg-gray-100 flex items-center justify-center text-2xl shrink-0"
                >
                  {{ obtenerEmojiCategoria(producto.categoria) }}
                </div>
                <div class="min-w-0 flex-1">
                  <p class="font-semibold text-gray-900 truncate">
                    {{ producto.nombre }}
                  </p>
                  <p class="text-sm text-gray-500 truncate">
                    {{ producto.descripcion }}
                  </p>
                  @if (producto.codigoBarras) {
                  <p class="text-xs text-gray-400">
                    CB: {{ producto.codigoBarras }}
                  </p>
                  }
                </div>
              </div>
            </td>

            <!-- Categor√≠a -->
            <td class="px-6 py-4 whitespace-nowrap">
              <span
                class="px-3 py-1 bg-gray-100 text-gray-700 text-xs font-semibold rounded-full"
              >
                {{ producto.categoria }}
              </span>
            </td>

            <!-- Precio Compra -->
            <td class="px-6 py-4 whitespace-nowrap text-right">
              <span class="text-sm font-medium text-gray-700">
                {{ formatearMoneda(producto.costoUnitario) }}
              </span>
            </td>

            <!-- Precio Venta -->
            <td class="px-6 py-4 whitespace-nowrap text-right">
              <span class="text-sm font-bold text-green-600">
                {{ formatearMoneda(producto.precioVenta) }}
              </span>
              <p class="text-xs text-gray-500">
                +{{ calcularMargenGanancia(producto).toFixed(1) }}%
              </p>
            </td>

            <!-- Stock -->
            <td class="px-6 py-4 whitespace-nowrap text-center">
              <span class="text-sm font-bold text-gray-900">
                {{ producto.stock }}
              </span>
              <p class="text-xs text-gray-500">
                M√≠n: {{ producto.stockMinimo }}
              </p>
            </td>

            <!-- Estado -->
            <td class="px-6 py-4 whitespace-nowrap text-center">
              <span
                [class]="obtenerClaseEstadoStock(producto)"
                class="px-3 py-1 text-xs font-bold rounded-full"
              >
                {{ obtenerTextoEstadoStock(producto) }}
              </span>
              @if (producto.esConsignacion) {
              <p class="text-xs text-purple-600 mt-1 font-semibold">
                ü§ù Consignaci√≥n
              </p>
              }
            </td>

            <!-- Acciones -->
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center justify-center gap-2">
                <button
                  (click)="abrirModalEditar(producto)"
                  class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs font-semibold rounded-lg transition-colors"
                >
                  ‚úèÔ∏è Editar
                </button>

                <button
                  (click)="eliminarProducto(producto)"
                  class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-xs font-semibold rounded-lg transition-colors"
                >
                  üóëÔ∏è
                </button>
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
  }

  <!-- Contador de resultados -->
  <div class="mt-4 text-center text-sm text-gray-600">
    Mostrando
    <span class="font-semibold">{{ productosFiltrados().length }}</span> de
    <span class="font-semibold">{{ productos().length }}</span> productos
  </div>
  } }

  <!-- Modal Placeholder -->
  @if (modalAbierto()) {
  <div
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 animate-fadeIn"
  >
    <div
      class="bg-white rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl"
    >
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-2xl font-bold text-gray-900">
          {{ productoSeleccionado() ? '‚úèÔ∏è Editar Producto' : '‚ûï Nuevo Producto'
          }}
        </h2>
        <button
          (click)="cerrarModal()"
          class="text-gray-400 hover:text-gray-600 text-2xl"
        >
          ‚úï
        </button>
      </div>

      <p class="text-gray-600 mb-4">
        Formulario en desarrollo... Pr√≥ximamente disponible.
      </p>

      <button
        (click)="cerrarModal()"
        class="w-full px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold rounded-lg transition-colors"
      >
        Cerrar
      </button>
    </div>
  </div>
  }

  <!-- ‚úÖ NUEVO: Modal de C√≥digo de Barras -->
  @if (modalCodigoBarrasAbierto() && productoCodigoBarras()) {
  <app-modal-codigo-barras
    [codigoBarras]="productoCodigoBarras()!.codigoBarras!"
    [nombreProducto]="productoCodigoBarras()!.nombre"
    (onCerrar)="cerrarModalCodigoBarras()"
  />
  }
</div>
