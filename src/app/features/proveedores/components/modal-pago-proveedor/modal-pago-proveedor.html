<div
  class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 animate-fadeIn"
  (click)="cerrar()"
>
  <div
    class="bg-white rounded-xl shadow-2xl w-full max-w-lg animate-slideUp"
    (click)="$event.stopPropagation()"
  >
    <!-- Header -->
    <header
      class="bg-linear-to-r from-green-600 to-green-700 text-white px-6 py-4 rounded-t-xl"
    >
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-2xl font-bold flex items-center gap-2">
            <span>üí∞</span>
            <span>Registrar Pago</span>
          </h2>
          <p class="text-green-100 text-sm mt-1">{{ proveedor().nombre }}</p>
        </div>
        <button
          (click)="cerrar()"
          class="text-white/80 hover:text-white text-3xl leading-none transition-colors"
          type="button"
        >
          ‚úï
        </button>
      </div>
    </header>

    <!-- Resumen de Deuda -->
    <div class="bg-red-50 border-l-4 border-red-500 p-4 mx-6 mt-6 rounded-lg">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-red-700 font-medium">Saldo Pendiente</p>
          <p class="text-3xl font-bold text-red-600 mt-1">
            ${{ proveedor().saldoPendiente.toLocaleString('es-MX', {
            minimumFractionDigits: 2 }) }}
          </p>
        </div>
        <button
          (click)="establecerMontoCompleto()"
          class="bg-red-600 hover:bg-red-700 text-white text-sm font-semibold px-4 py-2 rounded-lg transition-colors"
          type="button"
        >
          Pagar Todo
        </button>
      </div>
    </div>

    <!-- Formulario -->
    <form (ngSubmit)="registrarPago()" class="p-6 space-y-5">
      <!-- Monto -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">
          üíµ Monto del Pago <span class="text-red-500">*</span>
        </label>
        <input
          type="number"
          [(ngModel)]="monto"
          name="monto"
          [max]="montoMaximo()"
          min="0.01"
          step="0.01"
          placeholder="0.00"
          required
          class="w-full px-4 py-3 text-lg font-semibold border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
        />
        @if (monto() > montoMaximo()) {
        <p class="text-red-600 text-sm mt-1">
          ‚ö†Ô∏è El monto no puede exceder ${{ montoMaximo().toLocaleString('es-MX')
          }}
        </p>
        } @if (monto() > 0 && monto() <= montoMaximo()) {
        <p class="text-green-600 text-sm mt-1 font-medium">
          ‚úÖ Nuevo saldo: ${{ (proveedor().saldoPendiente -
          monto()).toLocaleString('es-MX', { minimumFractionDigits: 2 }) }}
        </p>
        }
      </div>

      <!-- M√©todo de Pago -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">
          M√©todo de Pago <span class="text-red-500">*</span>
        </label>
        <div class="grid grid-cols-3 gap-3">
          @for (metodo of metodosPago; track metodo.valor) {
          <button
            type="button"
            (click)="metodoPago.set(metodo.valor)"
            [class.bg-green-600]="metodoPago() === metodo.valor"
            [class.text-white]="metodoPago() === metodo.valor"
            [class.bg-gray-100]="metodoPago() !== metodo.valor"
            [class.text-gray-700]="metodoPago() !== metodo.valor"
            [class.border-2]="metodoPago() === metodo.valor"
            [class.border-green-600]="metodoPago() === metodo.valor"
            class="px-4 py-3 rounded-lg font-semibold transition-all hover:shadow-md text-sm"
          >
            {{ metodo.etiqueta }}
          </button>
          }
        </div>
      </div>

      <!-- Referencia de Pago -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">
          üîñ Referencia / N√∫mero de Transacci√≥n
        </label>
        <input
          type="text"
          [(ngModel)]="referenciaPago"
          name="referenciaPago"
          placeholder="Ej: TRANS-12345"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
        />
      </div>

      <!-- Observaciones -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">
          üìù Observaciones
        </label>
        <textarea
          [(ngModel)]="observaciones"
          name="observaciones"
          rows="3"
          placeholder="Nota adicional sobre el pago (opcional)"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"
        ></textarea>
      </div>

      <!-- Error -->
      @if (error()) {
      <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-lg">
        <p class="text-red-700 font-medium">‚ùå {{ error() }}</p>
      </div>
      }

      <!-- Botones -->
      <div class="flex gap-3 pt-4 border-t border-gray-200">
        <button
          type="button"
          (click)="cerrar()"
          [disabled]="procesando()"
          class="flex-1 bg-gray-200 hover:bg-gray-300 disabled:bg-gray-100 text-gray-700 font-semibold py-3 rounded-lg transition-colors disabled:cursor-not-allowed"
        >
          Cancelar
        </button>
        <button
          type="submit"
          [disabled]="!formularioValido()"
          class="flex-1 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white font-semibold py-3 rounded-lg transition-colors disabled:cursor-not-allowed flex items-center justify-center gap-2"
        >
          @if (procesando()) {
          <span class="animate-spin">‚è≥</span>
          <span>Procesando...</span>
          } @else {
          <span>üí∞</span>
          <span>Registrar Pago</span>
          }
        </button>
      </div>
    </form>
  </div>
</div>
