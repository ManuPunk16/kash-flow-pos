<div class="bg-white rounded-lg shadow-md p-6">
  <!-- Header -->
  <div
    class="flex items-center justify-between mb-6 pb-4 border-b-2 border-gray-200"
  >
    <h3 class="text-xl font-bold text-gray-900 flex items-center gap-2">
      <span class="text-2xl">üí∞</span>
      <span>Historial de Pagos</span>
    </h3>
    <button
      (click)="cargarHistorial()"
      [disabled]="cargando()"
      class="text-blue-600 hover:text-blue-700 font-semibold transition-colors disabled:opacity-50"
      title="Recargar historial"
    >
      üîÑ Recargar
    </button>
  </div>

  <!-- Loading State -->
  @if (cargando()) {
  <div class="text-center py-12">
    <div class="animate-spin text-5xl mb-3">‚è≥</div>
    <p class="text-gray-600 font-medium">Cargando historial...</p>
  </div>
  }

  <!-- Error State -->
  @else if (error()) {
  <div class="bg-red-50 border-l-4 border-red-500 p-5 rounded-lg">
    <div class="flex items-start gap-3">
      <span class="text-3xl">‚ùå</span>
      <div>
        <h4 class="font-bold text-red-800 mb-1">Error al cargar historial</h4>
        <p class="text-red-600 text-sm">{{ error() }}</p>
        <button
          (click)="cargarHistorial()"
          class="mt-3 bg-red-600 hover:bg-red-700 text-white text-sm font-semibold px-4 py-2 rounded-lg transition-colors"
        >
          Reintentar
        </button>
      </div>
    </div>
  </div>
  }

  <!-- Empty State -->
  @else if (pagos().length === 0) {
  <div class="text-center py-12">
    <span class="text-6xl block mb-4">üì≠</span>
    <h4 class="text-lg font-bold text-gray-800 mb-2">Sin pagos registrados</h4>
    <p class="text-gray-600">Este proveedor no tiene historial de pagos a√∫n</p>
  </div>
  }

  <!-- Resumen de Pagos -->
  @else {
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
    <!-- Total Pagado -->
    <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-lg">
      <p class="text-sm text-green-700 font-medium mb-1">Total Pagado</p>
      <p class="text-3xl font-bold text-green-600">
        ${{ totalPagado().toLocaleString('es-MX', { minimumFractionDigits: 2 })
        }}
      </p>
    </div>

    <!-- Cantidad de Pagos -->
    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg">
      <p class="text-sm text-blue-700 font-medium mb-1">Total de Pagos</p>
      <p class="text-3xl font-bold text-blue-600">{{ cantidadPagos() }}</p>
    </div>
  </div>

  <!-- Lista de Pagos -->
  <div class="space-y-4">
    @for (pago of pagos(); track pago._id) {
    <div
      class="bg-gray-50 rounded-lg p-5 hover:bg-gray-100 transition-colors border border-gray-200"
    >
      <!-- Fecha y Estado -->
      <div class="flex items-start justify-between mb-3">
        <div>
          <p class="text-sm font-semibold text-gray-800">
            üìÖ {{ pago.fechaPago | date: 'dd/MM/yyyy HH:mm' }}
          </p>
          <p class="text-xs text-gray-500 mt-1">
            Registrado por: {{ pago.nombreUsuario }}
          </p>
        </div>
        <span
          [class]="'px-3 py-1 rounded-full text-xs font-bold ' + obtenerColorEstado(pago.estado)"
        >
          {{ pago.estado === 'pagado' ? '‚úÖ Pagado' : '‚è≥ Pendiente' }}
        </span>
      </div>

      <!-- Detalles del Pago -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3">
        <!-- Monto -->
        <div class="flex items-center gap-2">
          <span class="text-2xl">üíµ</span>
          <div>
            <p class="text-xs text-gray-600">Monto</p>
            <p class="text-lg font-bold text-green-600">
              ${{ pago.monto.toLocaleString('es-MX', { minimumFractionDigits: 2
              }) }}
            </p>
          </div>
        </div>

        <!-- M√©todo de Pago -->
        <div class="flex items-center gap-2">
          <span class="text-2xl"
            >{{ obtenerIconoMetodoPago(pago.metodoPago) }}</span
          >
          <div>
            <p class="text-xs text-gray-600">M√©todo</p>
            <p class="text-sm font-semibold text-gray-800 capitalize">
              {{ pago.metodoPago }}
            </p>
          </div>
        </div>

        <!-- Nuevo Saldo -->
        <div class="flex items-center gap-2">
          <span class="text-2xl">üí∞</span>
          <div>
            <p class="text-xs text-gray-600">Nuevo Saldo</p>
            <p class="text-sm font-bold text-gray-800">
              ${{ pago.nuevoSaldo.toLocaleString('es-MX', {
              minimumFractionDigits: 2 }) }}
            </p>
          </div>
        </div>
      </div>

      <!-- Saldo Anterior ‚Üí Nuevo Saldo -->
      <div
        class="flex items-center justify-center gap-3 py-3 bg-white rounded-lg border border-gray-200"
      >
        <div class="text-center">
          <p class="text-xs text-gray-600 mb-1">Saldo Anterior</p>
          <p class="text-lg font-bold text-red-600">
            ${{ pago.saldoAnterior.toLocaleString('es-MX', {
            minimumFractionDigits: 2 }) }}
          </p>
        </div>
        <span class="text-2xl text-gray-400">‚Üí</span>
        <div class="text-center">
          <p class="text-xs text-gray-600 mb-1">Nuevo Saldo</p>
          <p class="text-lg font-bold text-green-600">
            ${{ pago.nuevoSaldo.toLocaleString('es-MX', { minimumFractionDigits:
            2 }) }}
          </p>
        </div>
      </div>

      <!-- Referencia y Observaciones -->
      @if (pago.referenciaPago || pago.observaciones) {
      <div class="mt-3 pt-3 border-t border-gray-300 space-y-2">
        @if (pago.referenciaPago) {
        <p class="text-sm text-gray-700">
          <span class="font-semibold">üîñ Referencia:</span> {{
          pago.referenciaPago }}
        </p>
        } @if (pago.observaciones) {
        <p class="text-sm text-gray-700">
          <span class="font-semibold">üìù Observaciones:</span> {{
          pago.observaciones }}
        </p>
        }
      </div>
      }
    </div>
    }
  </div>
  }
</div>
